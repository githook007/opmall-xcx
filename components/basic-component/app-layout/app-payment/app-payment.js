(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/basic-component/app-layout/app-payment/app-payment"],{"498e":function(t,e,a){},"74c2":function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.setPassword=!t.setPassword,t.password=""},t.e1=function(e){t.printPassword=!1,t.setPassword=!1,t.verifyPassword=!1},t.e2=function(e){t.getFocus=!1})},r=[];a.d(e,"a",function(){return s}),a.d(e,"b",function(){return r})},"8d3d":function(t,e,a){"use strict";a("498e")},a779:function(t,e,a){"use strict";a.r(e);var s=a("cd75"),r=a.n(s);for(var n in s)"default"!==n&&function(t){a.d(e,t,function(){return s[t]})}(n);e["default"]=r.a},bb6d:function(t,e,a){"use strict";a.r(e);var s=a("74c2"),r=a("a779");for(var n in r)"default"!==n&&function(t){a.d(e,t,function(){return r[t]})}(n);a("8d3d");var o=a("2877"),i=Object(o["a"])(r["default"],s["a"],s["b"],!1,null,"6bd45c34",null);e["default"]=i.exports},cd75:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=o(a("a34a")),r=o(a("66fd")),n=a("2f62");function o(t){return t&&t.__esModule?t:{default:t}}function i(t,e,a,s,r,n,o){try{var i=t[n](o),c=i.value}catch(p){return void a(p)}i.done?e(c):Promise.resolve(c).then(s,r)}function c(t){return function(){var e=this,a=arguments;return new Promise(function(s,r){var n=t.apply(e,a);function o(t){i(n,s,r,o,c,"next",t)}function c(t){i(n,s,r,o,c,"throw",t)}o(void 0)})}}function p(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,s)}return a}function y(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?p(a,!0).forEach(function(e){u(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):p(a).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}function u(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var d=function(){return a.e("components/basic-component/app-radio/app-radio").then(a.bind(null,"3ac8"))},l={name:"app-payment",components:{AppRadio:d},computed:y({},(0,n.mapState)({mall:function(t){return t.mallConfig.mall},userInfo:function(t){return t.user.info},showPayment:function(t){return t.payment.showPayment},payData:function(t){return t.payment.payData}}),{},(0,n.mapGetters)("mallConfig",{getTheme:"getTheme"})),data:function(){return{is_need_pay_password:0,haveFocus:!1,getFocus:!1,printPassword:!1,setPassword:!1,verifyPassword:!1,password:"",verify_pay_password:"",pay_password:"",payPassword:""}},created:function(){this.setPayment()},methods:{getInputFocus:function(){var t=this;this.$nextTick(function(){t.getFocus=!0})},passwordInput:function(){var e=this;6==this.password.length&&setTimeout(function(){e.setPassword?e.setPayPassword():(t.showLoading({mask:!0}),t.hideKeyboard(),e.verifyPayPassword())})},setPayPassword:function(){var e=this;if(this.password.length<6)return!1;if(this.verifyPassword)if(this.verify_pay_password=this.password.toString().substring(0,6),this.pay_password===this.verify_pay_password){t.showLoading({mask:!0});var a={pay_password:this.pay_password,verify_pay_password:this.verify_pay_password};this.$request({url:this.$api.member.set_password,method:"post",data:a}).then(function(a){t.hideLoading(),0===a.code?(e.payPassword=e.pay_password,e.printPassword=!1,e.setPassword=!1,e.verifyPassword=!1,e.password="",e.pay_password="",e.verify_pay_password="",e.$store.commit("payment/showPayment",!1),e.payByBalance()):(e.password="",e.pay_password="",e.verify_pay_password="",t.showToast({icon:"none",title:a.msg}))})}else this.verifyPassword=!1,this.password="",this.pay_password="",this.verify_pay_password="",t.showToast({icon:"none",title:"两次输入的密码不一致"});else this.pay_password=this.password.toString().substring(0,6),this.verifyPassword=!0,this.password=""},navPay:function(){this.$store.commit("payment/showPayment",!1),this.$store.state.payment.reject({errMsg:"5b03b6e009796c698d132908cb635fca"}),t.navigateTo({url:"/pages/balance/recharge"})},setPayment:function(){var t=this;r.default.use({install:function(e,a){e.prototype.$payment={pay:t.pay}}})},pay:function(e){var a=this;return new Promise(function(s,r){a.$store.commit("payment/setAll",{showPayment:!1,payData:null,payType:null,id:e,resolve:s,reject:r}),console.log("debug payment, setAll ok, id:",a.$store.state.payment.id),console.log("debug payment, setAll ok, resolve:",a.$store.state.payment.resolve),console.log("debug payment, setAll ok, reject:",a.$store.state.payment.reject),t.showLoading({mask:!0,title:"请求支付..."}),a.$request({url:a.$api.payment.get_payments,data:{id:e}}).then(function(e){return t.hideLoading(),console.log("debug 1---\x3e",e),0===e.code?(console.log("debug payment, set resolve 2,",a.$store.state.payment.resolve),a.showPaymentModal(e.data)):(e.errMsg=e.msg||"",a.$store.state.payment.reject(e.msg))}).catch(function(e){return t.hideLoading(),e.errMsg=e.msg||"",a.$store.state.payment.reject(e)})})},showPaymentModal:function(t){for(var e in console.log("debug 2---\x3e",t),t.list)"undefined"===typeof t.list[e].checked&&(t.list[e].checked=!1);if(this.$store.commit("payment/payData",t),0!==t.amount&&0!==t.amount&&"0"!==t.amount&&"0.00"!==t.amount)this.$store.commit("payment/showPayment",!0);else{for(var a in this.$store.commit("payment/payType","balance"),this.$store.state.payment.payData.list)"balance"===this.$store.state.payment.payData.list[a].key?this.$store.state.payment.payData.list[a].checked=!0:this.$store.state.payment.payData.list[a].checked=!1;this.confirm()}},confirm:function(){for(var e in console.log("payment confirm 1:"),console.log("debug payment, confirm 1,",this.$store.state.payment.resolve),this.$store.state.payment.payData.list)if(this.$store.state.payment.payData.list[e].checked){if("wechat_pay_for_another"==this.$store.state.payment.payData.list[e].key)return t.redirectTo({url:"/pages/order-submit/behalf?id=".concat(this.$store.state.payment.id,"&background=").concat(this.getTheme.background)}),this.$store.state.payment.payData=null,void this.$store.commit("payment/showPayment",!1);this.$store.commit("payment/payType",this.$store.state.payment.payData.list[e].key)}if(this.$store.state.payment.payType)return this.$store.commit("payment/showPayment",!1),console.log("payment confirm 2:",this.$store.state.payment.payType),console.log("debug payment, confirm 2,",this.$store.state.payment.resolve),this.getPayData();t.showModal({title:"提示",content:"请选择支付方式",showCancel:!1})},cancel:function(){return this.$store.commit("payment/showPayment",!1),this.$store.state.payment.reject({errMsg:"支付取消"})},checkPayType:function(t){if(this.$store.state.payment.payData.list[t].disabled||this.$store.state.payment.payData.list[t].checked)return!1;var e=this.$store.state.payment.payData;for(var a in e.list)e.list[a].checked=a==t;this.$store.commit("payment/payData",e)},getPayData:function(){var e=c(s.default.mark(function e(){var a,r,n=this;return s.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("debug payment, getPayData 1,",this.$store.state.payment.resolve),t.showLoading({mask:!0,title:"请求支付..."}),this,a={id:this.$store.state.payment.id,pay_type:this.$store.state.payment.payType},console.log(this.$store.state.payment.payType,9999999999999),"wechat"!==a.pay_type){e.next=11;break}return e.next=8,c(s.default.mark(function t(){return s.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,e){wx.checkBeforeAddOrder({success:function(e){return t(e)},fail:function(t){return e(t)}})}));case 1:case"end":return t.stop()}},t)}))();case 8:r=e.sent,console.log(r),"checkBeforeAddOrder:ok"===r.errMsg&&(a.traceData=JSON.stringify(r.data));case 11:this.$request({url:this.$api.payment.pay_data,data:a}).then(function(e){if(t.hideLoading(),0!==e.code)return n.$store.state.payment.reject(e.msg);switch(n.$store.state.payment.payType){case"balance":n.callBranch(e.data);break;case"huodao":n.callHuodao(e.data);break;default:console.log("debug payment, getPayData 2,",n.$store.state.payment.resolve),n.callPlatformPayment(e.data);break}}).catch(function(e){return t.hideLoading(),e.errMsg=e.msg||"",n.$store.state.payment.reject(e)});case 12:case"end":return e.stop()}},e,this)}));function a(){return e.apply(this,arguments)}return a}(),callBranch:function(e){var a=this;0===e.order_amount||0===e.order_amount||"0"===e.order_amount||"0.00"===e.order_amount?this.payByBalance():t.showModal({title:"余额支付确认",content:"账户余额：".concat(e.balance_amount,"，支付金额：").concat(e.order_amount),success:function(t){if(!t.confirm)return a.$store.state.payment.reject({errMsg:"支付取消."});var e=!0,s=!1,r=void 0;try{for(var n,o=a.payData.list[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var i=n.value;if("balance"==i.key){1==i.is_open_pay_password?(a.payPassword="",a.is_need_pay_password=i.is_pay_password,a.password="",a.$store.commit("payment/showPayment",!0),a.printPassword=!0,setTimeout(function(){a.getFocus=!0},800)):a.payByBalance();break}}}catch(c){s=!0,r=c}finally{try{e||null==o.return||o.return()}finally{if(s)throw r}}}})},verifyPayPassword:function(){var e=this;if(this.password.length<6)return!1;this.payPassword=this.password.toString().substring(0,6),this.$request({url:this.$api.member.verify_password,data:{pay_password:this.payPassword},method:"post"}).then(function(a){e.password="",t.hideLoading(),0===a.code?(e.$store.commit("payment/showPayment",!1),e.payByBalance()):(e.password="",e.payPassword="",t.showModal({title:"提示",content:a.msg,showCancel:!1}))}).catch(function(a){return t.hideLoading(),a.errMsg=a.msg||"",e.$store.state.payment.reject(a)})},payByBalance:function(){var e=this;t.showLoading({mask:!0,title:"支付中..."});var a={id:this.$store.state.payment.id,pay_password:this.payPassword?this.payPassword:"",is_need_pay_password:this.is_need_pay_password};this.$request({url:this.$api.payment.pay_buy_balance,data:a}).then(function(a){return t.hideLoading(),0===a.code?(e.$store.commit("payment/showPayment",!1),e.$store.state.payment.resolve({errMsg:"支付成功"})):e.$store.state.payment.reject({errMsg:a.msg})}).catch(function(t){return t.errMsg=t.msg||"",e.$store.state.payment.reject(t)})},callHuodao:function(){var e=this;t.showLoading({mask:!0,title:"提交中..."}),this.$request({url:this.$api.payment.pay_buy_huodao,data:{id:this.$store.state.payment.id}}).then(function(a){return t.hideLoading(),0===a.code?e.$store.state.payment.resolve({errMsg:"支付成功"}):e.$store.state.payment.reject({errMsg:a.msg})}).catch(function(a){return t.hideLoading(),a.errMsg=a.msg||"",e.$store.state.payment.reject(a)})},callPlatformPayment:function(e){var a=this;console.log("debug payment, callPlatformPayment 1,",this.$store.state.payment.resolve);var s=null;s=["wxpay"],t.requestOrderPayment(y({provider:s,success:function(t){return console.log("debug payment, callPlatformPayment 3,",a.$store.state.payment.resolve),console.log("success:",t),a.$store.state.payment.resolve(t)},fail:function(t){var e=["requestOrderPayment:fail cancel"];return t.errMsg&&e.indexOf(t.errMsg)>=0&&(t.errMsg="取消支付"),console.log("debug payment, callPlatformPayment 4,",a.$store.state.payment.resolve),console.log("fail:",t),a.$store.state.payment.reject(t)}},e))}}};e.default=l}).call(this,a("543d")["default"])}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/basic-component/app-layout/app-payment/app-payment-create-component',
    {
        'components/basic-component/app-layout/app-payment/app-payment-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("bb6d"))
        })
    },
    [['components/basic-component/app-layout/app-payment/app-payment-create-component']]
]);                
